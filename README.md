# weather-report-api
A Flask-based backend service that fetches time-series weather data from the Open-Meteo API and generates Excel files and PDF reports with charts.

## Tech Stack

- **Flask** - Web framework
- **SQLite** - Database
- **Open-Meteo API** - Weather data source
- **Pandas** - Data processing
- **Matplotlib** - Chart generation
- **OpenPyXL** - Excel export
- **WeasyPrint** - PDF generation

## Setup

### Local Setup

1. **Clone the repository:**
```bash
git clone <repository-url>
cd <repository-folder>
```

2. **Create virtual environment:**
```bash
python -m venv weather_env
```

3. **Activate virtual environment:**

Windows:
```bash
weather_env\Scripts\activate
```

Linux/Mac:
```bash
source weather_env/bin/activate
```

4. **Install dependencies:**
```bash
pip install -r requirements.txt
```

5. **Run the application:**
```bash
python app.py
```

The API will be available at `http://localhost:5000`

### Docker Setup

1. **Build and run with Docker Compose:**
```bash
docker-compose up --build
```

The API will be available at `http://localhost:5000`

## API Endpoints

### 1. Fetch Weather Data
```
GET /weather-report?lat={latitude}&lon={longitude}
```

Fetches weather data for the past 2 days and stores it in the database.

**Example:**
```bash
curl "http://localhost:5000/weather-report?lat=47.37&lon=8.55"
```

**Response:**
```json
{
  "message": "Weather data fetched and stored successfully",
  "location": {
    "latitude": 47.37,
    "longitude": 8.55
  },
  "data_points": 48
}
```

### 2. Export to Excel
```
GET /export/excel
```

Downloads weather data as an Excel file (`weather_data.xlsx`).

**Example:**
```bash
curl -O -J "http://localhost:5000/export/excel"
```

**Output:** Excel file with columns:
- timestamp
- temperature_2m
- relative_humidity_2m
- latitude
- longitude

### 3. Export to PDF
```
GET /export/pdf
```

Generates a PDF report with charts (`weather_report.pdf`).

**Example:**
```bash
curl -O -J "http://localhost:5000/export/pdf"
```

**Output:** PDF report containing:
- Location and date range
- Temperature chart
- Humidity chart
- Statistics table

## Example Usage

**Step 1:** Fetch weather data for Zurich, Switzerland
```bash
curl "http://localhost:5000/weather-report?lat=47.37&lon=8.55"
```

**Step 2:** Export to Excel
```bash
curl -O -J "http://localhost:5000/export/excel"
```

**Step 3:** Generate PDF report
```bash
curl -O -J "http://localhost:5000/export/pdf"
```

## Database

The app uses SQLite (`weather_data.db`) to store weather data. The database is created automatically on first run.

**Note:** The database file is generated at runtime and should not be committed to the repository.

## Example Output Files

The `example_outputs/` folder contains sample files generated by the API endpoints:

- **`weather_data.xlsx`** - Example Excel export showing weather data with temperature and humidity readings
- **`weather_report.pdf`** - Example PDF report with temperature/humidity charts and statistics

These files demonstrate the output format you can expect when using the `/export/excel` and `/export/pdf` endpoints.

## Docker Notes

- The Docker setup includes all system dependencies for PDF generation
- Database is stored in `./data` volume for persistence
- Health checks ensure the service is running properly
- Use `docker-compose down -v` to remove volumes when needed

## Project Structure

```
.
├── app.py              # Main Flask application
├── requirements.txt    # Python dependencies
├── Dockerfile          # Docker container configuration
├── docker-compose.yml  # Docker Compose setup
├── README.md           # This file
├── weather_data.db     # SQLite database (generated at runtime)
└── example_outputs/    # Example files generated from API
    ├── weather_data.xlsx   # Sample Excel export
    └── weather_report.pdf  # Sample PDF report
```

## Requirements

- Python 3.8+
- Dependencies listed in `requirements.txt`
- Docker (optional, for containerized deployment)

## License

MIT License
